---
import type { FeedItem } from '../types';
import { formatDistanceToNow } from '../utils/date';

export interface Props {
  link: FeedItem;
}

const { link } = Astro.props;

const timeAgo = formatDistanceToNow(new Date(link.publishedAt));
---

<article 
  class="link-item py-6 border-b border-border last:border-b-0"
  data-category={link.category}
  data-source={link.sourceId}
  data-priority={link.priority}
  data-tags={link.tags.join(',')}
>
  <!-- Metadata -->
  <div class="flex items-center gap-3 text-xs mb-2">
    <span class="font-medium text-primary">{link.sourceName}</span>
    <span class="text-text-subtle">·</span>
    <time datetime={link.publishedAt.toString()} class="text-text-subtle">
      {timeAgo}
    </time>
    {link.priority === 'breaking' && (
      <>
        <span class="text-text-subtle">·</span>
        <span class="inline-flex items-center px-2 py-1 text-xs font-bold text-white bg-red-600 rounded-full uppercase tracking-wide">
          ⚡ Breaking
        </span>
      </>
    )}
    {link.priority === 'high' && (
      <>
        <span class="text-text-subtle">·</span>
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium text-orange-800 bg-orange-100 rounded-full uppercase tracking-wide">
          High Priority
        </span>
      </>
    )}
  </div>
  
  <!-- Title -->
  <h2 class="mb-2">
    <a 
      href={link.url}
      target="_blank"
      rel="noopener noreferrer"
      class="text-lg font-semibold leading-snug text-foreground hover:text-primary transition-colors"
    >
      {link.title}
    </a>
  </h2>
  
  <!-- Summary -->
  {link.summary && link.summary.trim() ? (
    <p class="text-[15px] text-text-light leading-relaxed line-clamp-3 mb-3">
      {link.summary}
    </p>
  ) : (
    <p class="text-[13px] text-text-subtle italic mb-3">
      No preview available - click to read full article
    </p>
  )}
  
  <!-- Tags -->
  {link.tags.length > 0 && (
    <div class="flex flex-wrap gap-2">
      {link.tags.map((tag) => (
        <button 
          class="text-xs text-text-subtle hover:text-primary transition-colors"
          data-tag={tag}
          onclick="filterByTag(this.dataset.tag)"
        >
          #{tag.toLowerCase()}
        </button>
      ))}
    </div>
  )}
</article>

<style>
  /* Prevent horizontal overflow */
  .link-item {
    width: 100%;
    max-width: 100%;
    overflow-wrap: break-word;
    word-wrap: break-word;
    box-sizing: border-box;
  }
  
  .link-item h2 a {
    max-width: 100%;
    overflow-wrap: break-word;
    word-wrap: break-word;
    hyphens: auto;
    display: block;
  }
  
  .link-item p {
    max-width: 100%;
    overflow-wrap: break-word;
    word-wrap: break-word;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    max-width: 100%;
  }
  
  .link-item:first-child {
    border-top: 1px solid hsl(var(--border));
  }
  
  /* Responsive tag layout */
  .link-item div:last-child {
    max-width: 100%;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  
  .link-item div:last-child::-webkit-scrollbar {
    display: none;
  }
  
  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .link-item {
      padding-left: 12px;
      padding-right: 12px;
    }
    
    .link-item h2 a {
      font-size: 16px;
      line-height: 1.4;
    }
    
    .link-item p {
      font-size: 14px;
    }
    
    .link-item .flex {
      flex-wrap: wrap;
      gap: 8px;
    }
  }
</style>