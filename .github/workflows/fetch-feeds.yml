name: Fetch RSS Feeds

on:
  schedule:
    # Run every 30 minutes
    - cron: '*/30 * * * *'
  workflow_dispatch:  # Allow manual triggering
    inputs:
      limit_feeds:
        description: 'Limit number of feeds to process (for testing)'
        required: false
        default: ''
        type: string

jobs:
  fetch-feeds:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # Give plenty of time for all feeds
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: 'worker/package-lock.json'
        
    - name: Install dependencies
      run: npm install node-fetch
        
    - name: Run RSS Feed Fetcher
      run: node scripts/fetch-feeds.js